{% extends 'base.html' %}
{% load url from future %}
{% block title %}Corem {{ corem.corem_id }}{% endblock %}
{% block javascript %}
    <script type="text/javascript" src="/static/javascripts/isblogo_mod_ab.js"></script>
{% endblock %}
{% block nav %}
<!-- navigation starts-->
	<div  id="nav">
		<ul>
        <li><a href="{% url 'index' %}">Home</a></li>
        <li id="current"><a href="{% url 'browse' %}">Browse</a></li>
        <li><a href="{% url 'search' %}">Search</a></li>
        <li><a href="{% url 'downloads' %}">Downloads</a></li>
        <li><a href="{% url 'contact' %}">Support</a></li>
        <li><a href="{% url 'about' %}">About</a></li>
		</ul>
	<!-- navigation ends-->
	</div>	
{% endblock %}
{% block content %}
	<!-- content-wrap starts -->
	<div id="content-wrap">

		<div id="main">
            <script>
                {% include 'sciparse.html' %}
                $(document).ready(function() {
                
                $("#genes")
                .tablesorter({widthFixed: false, widgets: ['zebra'],sortList: [[1,0]] })
                .tablesorterPager({container: $("#pager_genes"), positionFixed: false});
                
                $("#gres")
                .tablesorter({widthFixed: false, widgets: ['zebra'],sortList: [[1,0], [0,0]],headers: { 1: {sorter:"sci"} } })
                .tablesorterPager({container: $("#pager_gres"), positionFixed: false});
                
                $("#conditions")
                .tablesorter({widthFixed: false, widgets: ['zebra'],sortList: [[2,0], [0,0]],headers: { 2: {sorter:"sci"} } })
                .tablesorterPager({container: $("#pager_conditions"), positionFixed: false});
                
                $("#biclusters")
                .tablesorter({widthFixed: false, widgets: ['zebra'],sortList: [[1,0], [0,0]],headers: { 1: {sorter:"sci"} } })
                .tablesorterPager({container: $("#pager_biclusters"), positionFixed: false});
                
                });
            </script>
			<blockquote><p>Expression</p></blockquote>
            <div>
            <img src="/static/images/expression/{{ s.ncbi_taxonomy_id }}/corems/{{ corem.corem_id }}.png" background-color="black" width=100% height=100% class="float-center" />
            <img src="/static/images/expression/{{ s.ncbi_taxonomy_id }}/corems/legend.png" background-color="black" width=100% height=100% class="float-center" />
            </div>
            <blockquote><p>Genes</p></blockquote>
                <table id="genes" class="table">
                    <thead>
                        <tr>
                            <th class="first">Organism</th>
                            <th>Gene name</th>
                            <th>Common name</th>
                            <th>Accession</th>
                            <th>Description</th>
                            <th>Start</th>
                            <th>Stop</th>
                            <th>Strand</th>
                            <th>Chromosome</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for g in genes %}
                            <tr class="{% cycle 'row-a' 'row-b' %}">
                                <td class="first"><a href="{% url 'species' %}{{ s.ncbi_taxonomy_id }}">{{ s.name }}</a></td>
                                <td><a href="{% url 'genes' %}{{ s.ncbi_taxonomy_id }}/{{ g.sys_name }}">{{ g.sys_name }}</a></td>
                                <td>{{ g.name }}</td>
                                <td><a href="http://www.ncbi.nlm.nih.gov/protein/{{ g.accession }}">{{ g.accession }}</a></td>
                                <td>{{ g.desc }}</td>
                                <td>{{ g.start }}</td>
                                <td>{{ g.stop }}</td>
                                <td>{{ g.strand }}</td>
                                <td><a href="http://www.ncbi.nlm.nih.gov/nuccore/{{ g.chromosome.refseq }}">{{ g.chromosome.refseq }}</a></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            <div id="pager_genes">
            {% include 'pager.html' %}

            <blockquote><p>GREs</p></blockquote>
                <table id="gres" class="table">
                    <thead>
                        <tr>
                            <th class="first">GRE ID</th>
                            <th>pval</th>
                            <th>PSSM</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for o in gre_obj %}
                            <tr class="{% cycle 'row-a' 'row-b' %}">
                                <td class="first"><a href="{% url 'gre_detail' s.ncbi_taxonomy_id o.gre_id %}">{{ o.gre_id }}</a></td>
                                <td>{{ o.corem_pval }}</td>
                                <td><img src="/static/images/gres/{{ s.ncbi_taxonomy_id }}/{{ o.gre_id }}.png" background-color="black" width=220 height=120 class="float-center" /></td>
                                <!-- <td><span id="previewcanvas_{{ o.gre_id }}"></span></td> -->
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div id="pager_gres">
                {% include 'pager.html' %}

            <blockquote><p>Conditional Activity</p></blockquote>
                <table id="conditions" class="table">
                    <thead>
                        <tr>
                            <th class="first">Condition ID</th>
                            <th>Condition Name</th>
                            <th>pval</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in conds_pval_dict.values %}
                            <tr class="{% cycle 'row-a' 'row-b' %}">
                                <td class="first"><a href="{% url 'conditions' %}{{ s.ncbi_taxonomy_id }}/{{ c.cond_id }}">{{ c.cond_id }}</a></td>
                                <td>{{ c.cond_name }}</td>
                                <td>{{ c.p_val }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div id="pager_conditions">
                {% include 'pager.html' %}
                
            <blockquote><p>Biclusters</p></blockquote>
                <table id="biclusters" class="table">
                    <thead>
                        <tr>
                            <th class="first">Bicluster ID</th>
                            <th>Residual</th>
                            <th>Genes</th>
                            <th>Conditions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for o in biclusters %}
                            <tr class="{% cycle 'row-a' 'row-b' %}">
                                <td class="first"><a href="{% url 'biclusters' %}{{ s.ncbi_taxonomy_id }}/{{ o.bc_id }}">{{ o.bc_id }}</a></td>
                                <td>{{ o.residual }}</td>
                                <td>{{ o.genes.count }}</td>
                                <td>{{ o.conditions.count }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div id="pager_biclusters">
                {% include 'pager.html' %}

		<!-- main ends -->
		</div>
<script>
<!--
    var ids = []
    var django_pssm = []
    {% for o in gre_obj %}
        ids.push({{ o.gre_id }})
        django_pssm.push({{ o.pssm }})
    {% endfor %}
    
    initCanvas2 = function (pssmMap, prefix, motifIds) {
        var i;
        for (i = 0; i < motifIds.length; i += 1) {
            var motifId = motifIds[i];
            var pssm = { alphabet: ['A', 'C', 'G', 'T'],
                        values: pssmMap[i]
                        };
            var canvas_id = prefix + motifId;
            var canvasOptions = {
                width: 220, //400,
                height: 120, //300,
                glyphStyle: '20pt Helvetica'
            };
            isblogo.makeLogo(canvas_id, pssm, canvasOptions);
            }
        };
    initCanvas2(django_pssm, 'previewcanvas_', ids);
//-->
</script>        
{% endblock %}
